<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Gallery Page</title>
    <style>
        .gallery {
            display: flex;
            flex-wrap: wrap;
        }
        .gallery-item {
            width: 200px;
            margin: 10px;
            cursor: pointer;
        }
        .gallery-item img {
            width: 100%;
            height: auto;
        }
        #selected-gallery {
            display: none;
        }
    </style>
</head>
<body>
    <div class="gallery" id="gallery"></div>
    <div id="selected-gallery"></div>

    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        async function authorize() {
            try {
                const response = await fetch('/authorize'); // Assuming your server has an endpoint for authorization
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error authorizing client:', error);
                return null;
            }
        }

        async function listFiles(auth) {
            try {
                const response = await fetch('/listFiles'); // Assuming your server has an endpoint for listing files
                const files = await response.json();
                return files;
            } catch (error) {
                console.error('Error listing files:', error);
                return [];
            }
        }

        async function displayGalleryItems() {
            const auth = await authorize();
            if (!auth) {
                console.error('Failed to authorize client.');
                return;
            }

            const files = await listFiles(auth);
            if (files.length === 0) {
                console.log('No files found.');
                return;
            }

            const galleryContainer = document.getElementById('gallery');
            files.forEach(file => {
                const galleryItem = document.createElement('div');
                galleryItem.classList.add('gallery-item');
                galleryItem.innerHTML = `<img src="${file.thumbnailLink}" alt="${file.name}" data-id="${file.id}">`;
                galleryItem.addEventListener('click', () => {
                    showSelectedGallery(file.id);
                });
                galleryContainer.appendChild(galleryItem);
            });
        }

        async function showSelectedGallery(fileId) {
            const auth = await authorize();
            if (!auth) {
                console.error('Failed to authorize client.');
                return;
            }

            try {
                const response = await fetch(`/getFile?fileId=${fileId}`); // Assuming your server has an endpoint for fetching a specific file
                const file = await response.json();
                const webViewLink = file.webViewLink;
                const selectedGalleryContainer = document.getElementById('selected-gallery');
                selectedGalleryContainer.innerHTML = `<iframe src="${webViewLink}" style="width: 100%; height: 500px;" frameborder="0"></iframe>`;
                selectedGalleryContainer.style.display = 'block';
            } catch (error) {
                console.error('Error fetching file:', error);
            }
        }

        displayGalleryItems();
    </script>
</body>
</html>
